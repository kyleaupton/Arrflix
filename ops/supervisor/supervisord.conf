[supervisord]
nodaemon=true
logfile=/dev/null
pidfile=/var/run/supervisord.pid

; Order via priorities: lower starts first.
[program:postgres]
command=/usr/local/bin/run-postgres.sh
; Uses env vars like POSTGRES_DB/USER/PASSWORD/PGDATA
priority=10
autorestart=true
startretries=10
stdout_logfile=/dev/stdout
stderr_logfile=/dev/stderr
stdout_logfile_maxbytes=0
stderr_logfile_maxbytes=0
environment=PGDATA="/var/lib/postgresql/data"
user=postgres

[program:jackett]
command=/bin/sh -c "/opt/jackett/jackett --NoUpdates --NoRestart"
directory=/opt/jackett
priority=10
autorestart=true
startretries=10
stdout_logfile=/dev/stdout
stderr_logfile=/dev/stderr
stdout_logfile_maxbytes=0
stderr_logfile_maxbytes=0

[program:api]
; API waits for DB and Jackett; exports Jackett API key
command=/bin/sh -c "/usr/local/bin/wait-for-db.sh && /usr/local/bin/wait-for-jackett.sh && export JACKETT_API_KEY=$(/usr/local/bin/jacket-print-apikey.sh) && exec /usr/local/bin/api"
priority=30
autorestart=true
startretries=10
stdout_logfile=/dev/stdout
stderr_logfile=/dev/stderr
stdout_logfile_maxbytes=0
stderr_logfile_maxbytes=0
environment=PORT="8080"

[program:nginx]
command=nginx -g "daemon off;"
priority=50
autorestart=true
startretries=10
stdout_logfile=/dev/stdout
stderr_logfile=/dev/stderr
stdout_logfile_maxbytes=0
stderr_logfile_maxbytes=0
