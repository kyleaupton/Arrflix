// Code generated by sqlc. DO NOT EDIT.
// versions:
//   sqlc v1.30.0
// source: download_job_events.sql

package dbgen

import (
	"context"

	"github.com/jackc/pgx/v5/pgtype"
)

const createDownloadJobEvent = `-- name: CreateDownloadJobEvent :one

INSERT INTO download_job_event (
  download_job_id,
  event_type,
  old_status,
  new_status,
  message,
  metadata
)
VALUES (
  $1,
  $2,
  $3,
  $4,
  $5,
  $6
)
RETURNING id, download_job_id, event_type, old_status, new_status, message, metadata, created_at
`

type CreateDownloadJobEventParams struct {
	DownloadJobID pgtype.UUID `json:"download_job_id"`
	EventType     string      `json:"event_type"`
	OldStatus     *string     `json:"old_status"`
	NewStatus     *string     `json:"new_status"`
	Message       *string     `json:"message"`
	Metadata      []byte      `json:"metadata"`
}

// Download job events (audit log)
func (q *Queries) CreateDownloadJobEvent(ctx context.Context, arg CreateDownloadJobEventParams) (DownloadJobEvent, error) {
	row := q.db.QueryRow(ctx, createDownloadJobEvent,
		arg.DownloadJobID,
		arg.EventType,
		arg.OldStatus,
		arg.NewStatus,
		arg.Message,
		arg.Metadata,
	)
	var i DownloadJobEvent
	err := row.Scan(
		&i.ID,
		&i.DownloadJobID,
		&i.EventType,
		&i.OldStatus,
		&i.NewStatus,
		&i.Message,
		&i.Metadata,
		&i.CreatedAt,
	)
	return i, err
}

const listDownloadJobEvents = `-- name: ListDownloadJobEvents :many
SELECT id, download_job_id, event_type, old_status, new_status, message, metadata, created_at FROM download_job_event
WHERE download_job_id = $1
ORDER BY created_at ASC
`

func (q *Queries) ListDownloadJobEvents(ctx context.Context, downloadJobID pgtype.UUID) ([]DownloadJobEvent, error) {
	rows, err := q.db.Query(ctx, listDownloadJobEvents, downloadJobID)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []DownloadJobEvent
	for rows.Next() {
		var i DownloadJobEvent
		if err := rows.Scan(
			&i.ID,
			&i.DownloadJobID,
			&i.EventType,
			&i.OldStatus,
			&i.NewStatus,
			&i.Message,
			&i.Metadata,
			&i.CreatedAt,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const listRecentDownloadJobEvents = `-- name: ListRecentDownloadJobEvents :many
SELECT id, download_job_id, event_type, old_status, new_status, message, metadata, created_at FROM download_job_event
ORDER BY created_at DESC
LIMIT $2
OFFSET $1
`

type ListRecentDownloadJobEventsParams struct {
	OffsetVal int32 `json:"offset_val"`
	LimitVal  int32 `json:"limit_val"`
}

func (q *Queries) ListRecentDownloadJobEvents(ctx context.Context, arg ListRecentDownloadJobEventsParams) ([]DownloadJobEvent, error) {
	rows, err := q.db.Query(ctx, listRecentDownloadJobEvents, arg.OffsetVal, arg.LimitVal)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []DownloadJobEvent
	for rows.Next() {
		var i DownloadJobEvent
		if err := rows.Scan(
			&i.ID,
			&i.DownloadJobID,
			&i.EventType,
			&i.OldStatus,
			&i.NewStatus,
			&i.Message,
			&i.Metadata,
			&i.CreatedAt,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}
