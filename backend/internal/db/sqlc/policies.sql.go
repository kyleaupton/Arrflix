// Code generated by sqlc. DO NOT EDIT.
// versions:
//   sqlc v1.30.0
// source: policies.sql

package dbgen

import (
	"context"

	"github.com/jackc/pgx/v5/pgtype"
)

const createAction = `-- name: CreateAction :one
insert into action (policy_id, type, value, "order")
values ($1, $2, $3, $4)
returning id, policy_id, type, value, "order", created_at, updated_at
`

type CreateActionParams struct {
	PolicyID    pgtype.UUID `json:"policy_id"`
	Type        string      `json:"type"`
	Value       string      `json:"value"`
	ActionOrder int32       `json:"action_order"`
}

func (q *Queries) CreateAction(ctx context.Context, arg CreateActionParams) (Action, error) {
	row := q.db.QueryRow(ctx, createAction,
		arg.PolicyID,
		arg.Type,
		arg.Value,
		arg.ActionOrder,
	)
	var i Action
	err := row.Scan(
		&i.ID,
		&i.PolicyID,
		&i.Type,
		&i.Value,
		&i.Order,
		&i.CreatedAt,
		&i.UpdatedAt,
	)
	return i, err
}

const createPolicy = `-- name: CreatePolicy :one
insert into policy (name, description, enabled, priority)
values ($1, $2, $3, $4)
returning id, name, description, enabled, priority, created_at, updated_at
`

type CreatePolicyParams struct {
	Name        string  `json:"name"`
	Description *string `json:"description"`
	Enabled     bool    `json:"enabled"`
	Priority    int32   `json:"priority"`
}

func (q *Queries) CreatePolicy(ctx context.Context, arg CreatePolicyParams) (Policy, error) {
	row := q.db.QueryRow(ctx, createPolicy,
		arg.Name,
		arg.Description,
		arg.Enabled,
		arg.Priority,
	)
	var i Policy
	err := row.Scan(
		&i.ID,
		&i.Name,
		&i.Description,
		&i.Enabled,
		&i.Priority,
		&i.CreatedAt,
		&i.UpdatedAt,
	)
	return i, err
}

const createRule = `-- name: CreateRule :one
insert into rule (policy_id, left_operand, operator, right_operand)
values ($1, $2, $3, $4)
returning id, policy_id, left_operand, operator, right_operand, created_at, updated_at
`

type CreateRuleParams struct {
	PolicyID     pgtype.UUID `json:"policy_id"`
	LeftOperand  string      `json:"left_operand"`
	Operator     string      `json:"operator"`
	RightOperand string      `json:"right_operand"`
}

func (q *Queries) CreateRule(ctx context.Context, arg CreateRuleParams) (Rule, error) {
	row := q.db.QueryRow(ctx, createRule,
		arg.PolicyID,
		arg.LeftOperand,
		arg.Operator,
		arg.RightOperand,
	)
	var i Rule
	err := row.Scan(
		&i.ID,
		&i.PolicyID,
		&i.LeftOperand,
		&i.Operator,
		&i.RightOperand,
		&i.CreatedAt,
		&i.UpdatedAt,
	)
	return i, err
}

const deleteAction = `-- name: DeleteAction :exec
delete from action where id = $1
`

func (q *Queries) DeleteAction(ctx context.Context, id pgtype.UUID) error {
	_, err := q.db.Exec(ctx, deleteAction, id)
	return err
}

const deletePolicy = `-- name: DeletePolicy :exec
delete from policy where id = $1
`

func (q *Queries) DeletePolicy(ctx context.Context, id pgtype.UUID) error {
	_, err := q.db.Exec(ctx, deletePolicy, id)
	return err
}

const deleteRule = `-- name: DeleteRule :exec
delete from rule where id = $1
`

func (q *Queries) DeleteRule(ctx context.Context, id pgtype.UUID) error {
	_, err := q.db.Exec(ctx, deleteRule, id)
	return err
}

const deleteRuleForPolicy = `-- name: DeleteRuleForPolicy :exec
delete from rule where policy_id = $1
`

func (q *Queries) DeleteRuleForPolicy(ctx context.Context, policyID pgtype.UUID) error {
	_, err := q.db.Exec(ctx, deleteRuleForPolicy, policyID)
	return err
}

const getAction = `-- name: GetAction :one
select id, policy_id, type, value, "order", created_at, updated_at from action
where id = $1
`

func (q *Queries) GetAction(ctx context.Context, id pgtype.UUID) (Action, error) {
	row := q.db.QueryRow(ctx, getAction, id)
	var i Action
	err := row.Scan(
		&i.ID,
		&i.PolicyID,
		&i.Type,
		&i.Value,
		&i.Order,
		&i.CreatedAt,
		&i.UpdatedAt,
	)
	return i, err
}

const getPolicy = `-- name: GetPolicy :one
select id, name, description, enabled, priority, created_at, updated_at from policy
where id = $1
`

func (q *Queries) GetPolicy(ctx context.Context, id pgtype.UUID) (Policy, error) {
	row := q.db.QueryRow(ctx, getPolicy, id)
	var i Policy
	err := row.Scan(
		&i.ID,
		&i.Name,
		&i.Description,
		&i.Enabled,
		&i.Priority,
		&i.CreatedAt,
		&i.UpdatedAt,
	)
	return i, err
}

const getRuleForPolicy = `-- name: GetRuleForPolicy :one

select id, policy_id, left_operand, operator, right_operand, created_at, updated_at from rule
where policy_id = $1
`

// Rules
func (q *Queries) GetRuleForPolicy(ctx context.Context, policyID pgtype.UUID) (Rule, error) {
	row := q.db.QueryRow(ctx, getRuleForPolicy, policyID)
	var i Rule
	err := row.Scan(
		&i.ID,
		&i.PolicyID,
		&i.LeftOperand,
		&i.Operator,
		&i.RightOperand,
		&i.CreatedAt,
		&i.UpdatedAt,
	)
	return i, err
}

const listActionsForPolicy = `-- name: ListActionsForPolicy :many

select id, policy_id, type, value, "order", created_at, updated_at from action
where policy_id = $1
order by action."order" asc
`

// Actions
func (q *Queries) ListActionsForPolicy(ctx context.Context, policyID pgtype.UUID) ([]Action, error) {
	rows, err := q.db.Query(ctx, listActionsForPolicy, policyID)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []Action
	for rows.Next() {
		var i Action
		if err := rows.Scan(
			&i.ID,
			&i.PolicyID,
			&i.Type,
			&i.Value,
			&i.Order,
			&i.CreatedAt,
			&i.UpdatedAt,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const listPolicies = `-- name: ListPolicies :many

select id, name, description, enabled, priority, created_at, updated_at from policy
order by priority desc, created_at desc
`

// Policies
func (q *Queries) ListPolicies(ctx context.Context) ([]Policy, error) {
	rows, err := q.db.Query(ctx, listPolicies)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []Policy
	for rows.Next() {
		var i Policy
		if err := rows.Scan(
			&i.ID,
			&i.Name,
			&i.Description,
			&i.Enabled,
			&i.Priority,
			&i.CreatedAt,
			&i.UpdatedAt,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const updateAction = `-- name: UpdateAction :one
update action
set type = $1,
    value = $2,
    "order" = $3,
    updated_at = now()
where id = $4
returning id, policy_id, type, value, "order", created_at, updated_at
`

type UpdateActionParams struct {
	Type        string      `json:"type"`
	Value       string      `json:"value"`
	ActionOrder int32       `json:"action_order"`
	ID          pgtype.UUID `json:"id"`
}

func (q *Queries) UpdateAction(ctx context.Context, arg UpdateActionParams) (Action, error) {
	row := q.db.QueryRow(ctx, updateAction,
		arg.Type,
		arg.Value,
		arg.ActionOrder,
		arg.ID,
	)
	var i Action
	err := row.Scan(
		&i.ID,
		&i.PolicyID,
		&i.Type,
		&i.Value,
		&i.Order,
		&i.CreatedAt,
		&i.UpdatedAt,
	)
	return i, err
}

const updatePolicy = `-- name: UpdatePolicy :one
update policy
set name = $1,
    description = $2,
    enabled = $3,
    priority = $4,
    updated_at = now()
where id = $5
returning id, name, description, enabled, priority, created_at, updated_at
`

type UpdatePolicyParams struct {
	Name        string      `json:"name"`
	Description *string     `json:"description"`
	Enabled     bool        `json:"enabled"`
	Priority    int32       `json:"priority"`
	ID          pgtype.UUID `json:"id"`
}

func (q *Queries) UpdatePolicy(ctx context.Context, arg UpdatePolicyParams) (Policy, error) {
	row := q.db.QueryRow(ctx, updatePolicy,
		arg.Name,
		arg.Description,
		arg.Enabled,
		arg.Priority,
		arg.ID,
	)
	var i Policy
	err := row.Scan(
		&i.ID,
		&i.Name,
		&i.Description,
		&i.Enabled,
		&i.Priority,
		&i.CreatedAt,
		&i.UpdatedAt,
	)
	return i, err
}

const updateRule = `-- name: UpdateRule :one
update rule
set left_operand = $1,
    operator = $2,
    right_operand = $3,
    updated_at = now()
where id = $4
returning id, policy_id, left_operand, operator, right_operand, created_at, updated_at
`

type UpdateRuleParams struct {
	LeftOperand  string      `json:"left_operand"`
	Operator     string      `json:"operator"`
	RightOperand string      `json:"right_operand"`
	ID           pgtype.UUID `json:"id"`
}

func (q *Queries) UpdateRule(ctx context.Context, arg UpdateRuleParams) (Rule, error) {
	row := q.db.QueryRow(ctx, updateRule,
		arg.LeftOperand,
		arg.Operator,
		arg.RightOperand,
		arg.ID,
	)
	var i Rule
	err := row.Scan(
		&i.ID,
		&i.PolicyID,
		&i.LeftOperand,
		&i.Operator,
		&i.RightOperand,
		&i.CreatedAt,
		&i.UpdatedAt,
	)
	return i, err
}
