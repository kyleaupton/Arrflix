// Code generated by sqlc. DO NOT EDIT.
// versions:
//   sqlc v1.30.0
// source: api_cache.sql

package dbgen

import (
	"context"
	"time"
)

const deleteExpiredApiCache = `-- name: DeleteExpiredApiCache :exec
delete from api_cache where expires_at <= now()
`

func (q *Queries) DeleteExpiredApiCache(ctx context.Context) error {
	_, err := q.db.Exec(ctx, deleteExpiredApiCache)
	return err
}

const getApiCache = `-- name: GetApiCache :one
select key, category, response, status, content_type, headers, stored_at, expires_at
from api_cache
where key = $1
  and expires_at > now()
`

type GetApiCacheRow struct {
	Key         string    `json:"key"`
	Category    *string   `json:"category"`
	Response    []byte    `json:"response"`
	Status      int32     `json:"status"`
	ContentType *string   `json:"content_type"`
	Headers     []byte    `json:"headers"`
	StoredAt    time.Time `json:"stored_at"`
	ExpiresAt   time.Time `json:"expires_at"`
}

func (q *Queries) GetApiCache(ctx context.Context, key string) (GetApiCacheRow, error) {
	row := q.db.QueryRow(ctx, getApiCache, key)
	var i GetApiCacheRow
	err := row.Scan(
		&i.Key,
		&i.Category,
		&i.Response,
		&i.Status,
		&i.ContentType,
		&i.Headers,
		&i.StoredAt,
		&i.ExpiresAt,
	)
	return i, err
}

const upsertApiCache = `-- name: UpsertApiCache :exec
insert into api_cache (key, category, response, status, content_type, headers, expires_at)
values ($1, $2, $3, $4, $5, $6, $7)
on conflict (key)
do update set
	category = excluded.category,
	response = excluded.response,
	status = excluded.status,
	content_type = excluded.content_type,
	headers = excluded.headers,
	stored_at = now(),
	expires_at = excluded.expires_at
`

type UpsertApiCacheParams struct {
	Key         string    `json:"key"`
	Category    *string   `json:"category"`
	Response    []byte    `json:"response"`
	Status      int32     `json:"status"`
	ContentType *string   `json:"content_type"`
	Headers     []byte    `json:"headers"`
	ExpiresAt   time.Time `json:"expires_at"`
}

func (q *Queries) UpsertApiCache(ctx context.Context, arg UpsertApiCacheParams) error {
	_, err := q.db.Exec(ctx, upsertApiCache,
		arg.Key,
		arg.Category,
		arg.Response,
		arg.Status,
		arg.ContentType,
		arg.Headers,
		arg.ExpiresAt,
	)
	return err
}
